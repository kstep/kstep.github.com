<html>
<head lang="">
    <meta charset="utf-8" />
    <title ng-meta="page.title">Текущая ревизия/ветка git и svn в командной строке zsh</title>
    <meta name="keywords" ng-meta="page.tags" value="[]" content="" />
    <meta name="date" ng-meta="page.date" content="2009-07-08" />
    <meta http-equiv="Refresh" content="0;URL='/#!/2009/07/08/tekuschaya_reviziyavetka_git_i_svn_v_komandnoj_stroke_zsh.html'" />
</head>
<body>
<h1>
    Текущая ревизия/ветка git и svn в командной строке zsh <small><nobr ng-bind="page.date | asdate:locale.date_format" class="published">2009-07-08</nobr></small>
</h1>

<div>
  <pre><code class="bash">function vcs_head()
{
if [[ -d ./.svn ]]; then
    svn info | awk -v FS=&quot;: &quot; &#39;/URL:/ { url=$2 } /Repository Root:/ { baseurl=$2 } /Revision:/ { rev=$2 } END { branch = substr(url, length(baseurl) + 2); if (match(branch, /^(trunk|branches\\/[^\\/]+|tags\\/[^\\/]+)/) &gt; 0) { branch = substr(branch, RSTART, RLENGTH) &quot;-&quot;; } else { branch = &quot;&quot; }; print &quot;@&quot; branch &quot;r&quot; rev }&#39;
else
    gitref=`(git symbolic-ref HEAD || git rev-parse --short HEAD) 2&gt; /dev/null | sed -e &#39;s#refs/heads/##&#39;`
    [[ -n $gitref ]] &amp;&amp; echo -n &quot;@$gitref&quot;
fi
}

export PROMPT=$&#39;%{\\e[1;32m%}%n@%{\\e[1;34m%}%m:%{\\e[1;35m%}%l%{\\e[1;31m%}%5(~.&lt;.)%4~%{\\e[0;36m%}`vcs_head`%{\\e[0m%}%{\\e[1;36m%}%# %{\\e[0m%}&#39;</code></pre>
</div>

<p>Таким образом если мы в svn-чекауте то нам показывается текущая ветка и ревизия, а если в репозитории git-а, то показывается либо наша ветка/тег, либо (в случае отделённой ветки) хеш последнего коммита.</p>


<p class="clearfix tags">
    
</p>
</body></html>
