(function(){var d,a,b,c=[].slice;b=function(e){return function(){return e}};a=function(e){return function(f){return f[e]}};d=angular.module("kstep",["ng","ngSanitize","ngCookies"]);d.config(["$routeProvider","$locationProvider","$interpolateProvider",function(g,f,e){g.when("/",{controller:"BlogCtl",templateUrl:"/partials/list.html"}).when("/tags",{controller:"TagsCtl",templateUrl:"/partials/tags.html"}).when("/tag/:tag",{controller:"TagCtl",templateUrl:"/partials/tag.html"}).when("/:year/:month/:day/:name.html",{controller:"PostCtl",templateUrl:"/partials/post.html"}).when("/:year/:month/:day",{controller:"BlogCtl",templateUrl:"/partials/date.html"}).when("/:year/:month",{controller:"BlogCtl",templateUrl:"/partials/date.html"}).when("/:year",{controller:"BlogCtl",templateUrl:"/partials/date.html"}).otherwise({redirectTo:"/"});f.html5Mode(false);f.hashPrefix("!");e.startSymbol("{:");return e.endSymbol(":}")}]);d.filter("strip_tags",function(){var e;e=/<\/[a-zA-Z][a-zA-Z0-9]*>|<[a-zA-Z][a-zA-Z0-9]*(\s+[^>]*?)?\/?>/g;return function(f){return(f||"").toString().replace(e,"")}});d.filter("rot13",function(){var f,e;e=/[a-zA-Z]/g;f=function(g){return String.fromCharCode((g<="Z"?90:122)>=(g=g.charCodeAt(0)+13)?g:g-26)};return function(g){return(g||"").toString().replace(e,f)}});d.filter("asdate",["$filter",function(e){return function(g,f){return e("date")(new Date(g),f)}}]);d.filter("lower",function(){return function(e){return(e||"").toString().toLowerCase()}});d.filter("upper",function(){return function(e){return(e||"").toString().toUpperCase()}});d.factory("locales",["$http","$rootScope","$cookies",function(h,g,f){var e;e=function(i){return g.locale=h.get("/i18n/"+i+".json").then(function(j){j.data.lang=i;f.lang=i;return j.data})};e(f.lang||"en");return e}]);d.directive("youtube",function(){return{restrict:"AE",scope:true,replace:true,template:'<iframe ng-src="http://www.youtube.com/embed/{: id :}" width="{: width :}" height="{: height :}" frameborder="0" allowfullscreen></iframe>',compile:function(h,f){var e,g,i;i=f.youtube||f.id;g=parseInt(f.width,10)||560;e=parseInt(f.height,10)||315;return function(k,l,j){k.id=i;k.width=g;return k.height=e}}}});d.directive("totop",["$window",function(e){return{restrict:"AC",compile:function(g,f){var h;h=$(e);h.bind("scroll",function(i){return g.css("display",h.scrollTop()>h.height()/3?"":"none")});g.css("display","none");return function(j,k,i){return k.bind("click",function(){h.scrollTop(0);return k.css("display","none")})}}}}]);d.factory("appcache",["$window","$rootScope",function(h,g){var f,e;f=h.applicationCache||{fakeAppCache:true,UNCACHED:0,IDLE:1,CHECKING:2,DOWNLOADING:3,UPDATEREADY:4,OBSOLETE:5,oncached:null,onchecking:null,ondownloading:null,onnoupdate:null,onobsolete:null,onupdateready:null,status:1,addEventListener:angular.noop,dispatchEvent:angular.noop,removeEventListener:angular.noop,swapCache:angular.noop,update:angular.noop};e={};f.bind=function(i,j){return f.addEventListener(i,(e[j]=function(k){return j.call(this,k(g.$apply()))}),false)};f.unbind=function(i,j){return f.removeEventListener(i,e[j]||j,false)};return f}]);d.factory("$jsload",["$timeout","$q","$document","$rootScope",function(h,g,j,i){var f,e;f={};e={};return function(m,l){var k;if(e[m]){return e[m]}k=g.defer();if(!l&&f[m]){k.resolve(f[m])}else{e[m]=k.promise;if(f[m]){f[m].parentNode.removeChild(f[m]);delete f[m]}h(function(){var n;n=j[0].createElement("script");n.type="text/javascript";n.async=true;n.src=m;n.onerror=function(o){delete e[m];k.reject(n);return i.$digest()};n.onreadystatechange=n.onload=function(o){delete e[m];if(!o.readyState||o.readyState==="loaded"){f[m]=n;k.resolve(n);return i.$digest()}};return j[0].getElementsByTagName("head")[0].appendChild(n)})}return k.promise}}]);d.factory("Pager",function(){return function(f,e,g){this.total_pages=0;this.pages=[];this.set_page=function(i){var h,k,j;h=Math.ceil(f.length/e);if(h!==this.total_pages){this.total_pages=h;this.pages=(function(){j=[];for(var l=1;1<=h?l<=h:l>=h;1<=h?l++:l--){j.push(l)}return j}).apply(this)}this.page=i<1?1:i>h?h:i;this.slice=f.slice((this.page-1)*e,this.page*e);return this};return this.set_page(g)}});d.factory("Disqus",["$window","$jsload",function(f,e){return function(g){return e("http://"+g+".disqus.com/embed.js",true).then(function(){return f.DISQUS})}}]);d.directive("disqus",["$location","$window","Disqus","$parse",function(i,h,g,f){var e;e=0;return{restrict:"ACE",terminal:true,compile:function(l,k){var m,j;j=k.disqus||k.name;m=k.id;if(!j){return}if(!m){l.attr("id",m="disqus_thread"+e++)}return function(o,p,n){h.disqus_identifier=i.path();h.disqus_url=i.absUrl();h.disqus_container_id=m;h.DISQUS=void 0;p.html("");return g(j)}}}}]);d.config(["$httpProvider",function(e){return e.responseInterceptors.push(["$rootScope","$q",function(g,f){return function(h){g.$loading=true;return h.then((function(i){g.$loading=false;return i}),(function(i){g.$loading=false;return f.reject(i)}))}}])}]);d.directive("ngMeta",["$parse",function(e){return{restrict:"E",terminal:true,compile:function(i,g){var j,h,f;if(!g.value&&!g.update){return}j=e(g.name);f=g.value?e(g.value):null;h=g.update?e(g.update):null;return function(l,m,k){if(f!=null){j.assign(l,f(l))}if(h!=null){return angular.extend(j(l),h(l))}}}}}]);d.provider("GA",function(){var e;e=[];return{setAccount:function(h,g){var f;if(!g){f=[h,g],g=f[0],h=f[1]}e.push(["_setAccount",g]);if(h){e.push(["_setDomainName",h])}return this},$get:["$window","$location","$jsload","$timeout",function(i,j,f,g){var h;i._gaq=e;h=j.protocol()==="https"?"https://ssl":"http://www";f(h+".google-analytics.com/ga.js");return function(){var k;k=1<=arguments.length?c.call(arguments,0):[];return i._gaq.push(k)}}]}});d.config(["GAProvider",function(e){return e.setAccount("kstep.me","UA-23938138-1")}]);d.controller("RootCtl",["$scope","$http","locales","appcache","$window","GA","$location",function(f,k,e,g,h,j,i){g.bind("updateready",function(){f.update_available=true;return g.swapCache()});f.page={};f.locales=e;f.reload_site=function(){return h.location.reload()};return f.social_accounts=[{url:"https://twitter.com/kstepme",icon:"http://twitter.com/favicon.ico",name:"Twitter"},{url:"http://www.linkedin.com/pub/konstantin-stepanov/54/47/450",icon:"http://www.linkedin.com/favicon.ico",name:"LinkedIn"},{url:"http://kstepme.moikrug.ru/",icon:"http://moikrug.ru/favicon.ico",name:"Мой Круг"},{url:"http://welinux.ru/user/kstep/",icon:"http://welinux.ru/favicon.ico",name:"WeLinux"},{url:"https://github.com/kstep",icon:"http://github.com/favicon.ico",name:"Github"},{url:"http://www.ohloh.net/accounts/kstep",icon:"http://www.ohloh.net/favicon.ico",name:"Ohloh"},{url:"http://search.cpan.org/~kstepme/",icon:"http://search.cpan.org/favicon.ico",name:"CPAN"},f.$on("$routeChangeSuccess",function(){return j("_trackPageview",i.path())})]}]);d.controller("PostCtl",["$scope","$routeParams",function(f,e){return angular.extend(f.page,{url:"/"+e.year+"/"+e.month+"/"+e.day+"/"+e.name+".html",group:"blog"})}]);d.controller("BlogCtl",["$scope","$routeParams","$http","Pager",function(f,e,i,h){var g;f.$watch("locale.index_title",function(j){return f.page.title=j});angular.extend(f.page,{title:f.locale.index_title,url:"/",group:"blog"});g=(""+(e.year||"")+"-"+(e.month||"")+"-"+(e.day||"")).replace(/-+$/g,"");f.date={year:e.year,month:e.month,day:e.day};return f.pager=i.get("/data/list.json").then(function(j){var l,k;k=g?(function(){var p,n,o,m;o=j.data;m=[];for(p=0,n=o.length;p<n;p++){l=o[p];if(l.date.indexOf(g)!==-1){m.push(l)}}return m})():j.data;return new h(k,40,1)})}]);d.controller("TagCtl",["$scope","$http","$routeParams",function(f,g,e){f.$watch("locale.tag",function(h){return f.page.title=h+" — "+e.tag});angular.extend(f.page,{url:"/tag/"+e.tag,group:"tags"});return g.get("/data/tags.json").success(function(h){f.tag=h[e.tag];return f.tag.name=e.tag})}]);d.controller("TagsCtl",["$scope","$http",function(e,f){e.$watch("locale.tag_cloud",function(g){return e.page.title=g});angular.extend(e.page,{url:"/tags",group:"tags"});return f.get("/data/tags.json").success(function(j){var l,h,k,i,g;k=Infinity;h=-Infinity;for(i in j){g=j[i];if(g.size<k){k=g.size}if(g.size>h){h=g.size}}l=h-k;for(i in j){g=j[i];g.size=(g.size-k)/l}return e.tags=j})}])}).call(this);