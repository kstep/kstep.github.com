"use strict";function valueFn(a){return function(){return a}}function attr(a){return function(b){return b[a]}}(function(b,c,a,d){b.module("kstep",["ng","ngSanitize","ngCookies"]).config(["$routeProvider","$locationProvider","$interpolateProvider",function(g,f,e){g.when("/",{controller:"BlogCtl",templateUrl:"/partials/list.html"}).when("/tags",{controller:"TagsCtl",templateUrl:"/partials/tags.html"}).when("/tag/:tag",{controller:"TagCtl",templateUrl:"/partials/tag.html"}).when("/:year/:month/:day/:name.html",{controller:"PostCtl",templateUrl:"/partials/post.html"}).when("/:year/:month/:day",{controller:"BlogCtl",templateUrl:"/partials/date.html"}).when("/:year/:month",{controller:"BlogCtl",templateUrl:"/partials/date.html"}).when("/:year",{controller:"BlogCtl",templateUrl:"/partials/date.html"}).otherwise({redirectTo:"/"});f.html5Mode(false).hashPrefix("!");e.startSymbol("{:").endSymbol(":}")}]).filter("strip_tags",[function(){var e=/<\/[a-zA-Z][a-zA-Z0-9]*>|<[a-zA-Z][a-zA-Z0-9]*(\s+[^>]*?)?\/?>/g;return function(f){return(f||"").toString().replace(e,"")}}]).filter("rot13",[function(){var e=/[a-zA-Z]/g,f=function(g){return String.fromCharCode((g<="Z"?90:122)>=(g=g.charCodeAt(0)+13)?g:g-26)};return function(g){return(g||"").toString().replace(e,f)}}]).filter("asdate",["$filter",function(e){return function(g,f){return e("date")(new Date(g),f)}}]).filter("lower",[function(){return function(e){return(e||"").toString().toLowerCase()}}]).filter("upper",[function(){return function(e){return(e||"").toString().toUpperCase()}}]).factory("locales",["$http","$rootScope","$cookies",function(h,g,f){var e=function(i){g.locale=h.get("/i18n/"+i+".json").then(function(j){j.data.lang=i;f.lang=i;return j.data});return g.locale};e(f.lang||"en");return e}]).directive("youtube",[function(){return{restrict:"AE",scope:true,replace:true,template:'<iframe ng-src="http://www.youtube.com/embed/{: id :}" width="{: width :}" height="{: height :}" frameborder="0" allowfullscreen></iframe>',compile:function(h,f){var i=f.youtube||f.id,g=parseInt(f.width,10)||560,e=parseInt(f.height,10)||315;return function(k,l,j){k.id=i;k.width=g;k.height=e}}}}]).directive("totop",["$window",function(e){return{restrict:"AC",compile:function(g,f){var h=c(e);h.bind("scroll",function(i){g.css("display",h.scrollTop()>h.height()/3?"":"none")});g.css("display","none");return function(j,k,i){k.bind("click",function(){h.scrollTop(0);k.css("display","none")})}}}}]).factory("$jsload",["$timeout","$q","$document","$rootScope",function(h,g,j,i){var f={},e={};return function(m,l){if(e[m]){return e[m]}var k=g.defer();if(!l&&f[m]){k.resolve(f[m])}else{e[m]=k.promise;if(f[m]){f[m].parentNode.removeChild(f[m]);delete f[m]}h(function(){var n=j[0].createElement("script");n.type="text/javascript";n.async=true;n.src=m;n.onerror=function(o){delete e[m];k.reject(n);i.$digest()};n.onreadystatechange=n.onload=function(o){delete e[m];if(!o.readyState||o.readyState==="loaded"){f[m]=n;k.resolve(n);i.$digest()}};j[0].getElementsByTagName("head")[0].appendChild(n)})}return k.promise}}]).factory("Pager",[function(){return function(h,f,i){var g=h.length,e=Math.ceil(g/f);this.total_pages=0;this.pages=[];this.set_page=function(k){var j=Math.ceil(h.length/f);if(j!==this.total_pages){this.total_pages=j;this.pages=[];var l;for(l=0;l<j;l++){this.pages.push(l+1)}}if(k<1){k=1}else{if(k>j){k=j}}this.page=k;var n=(k-1)*f,m=n+f;this.slice=h.slice(n,m)};this.set_page(i)}}]).factory("Disqus",["$window","$jsload",function(f,e){return function(g){return e("http://"+g+".disqus.com/embed.js",true).then(function(){return f.DISQUS})}}]).directive("disqus",["$location","$window","Disqus","$parse",function(i,h,g,f){var e=0;return{restrict:"ACE",terminal:true,compile:function(l,k){var j=k.disqus||k.name,m=k.id;if(!j){return}if(!m){m="disqus_thread"+(e++);l.attr("id",m)}return function(o,p,n){h.disqus_identifier=i.path();h.disqus_url=i.absUrl();h.disqus_container_id=m;h.DISQUS=d;p.html("");g(j)}}}}]).config(["$httpProvider",function(e){e.responseInterceptors.push(["$rootScope","$q",function(f,g){return function(h){f.$loading=true;return h.then(function(i){f.$loading=false;return i},function(i){f.$loading=false;return g.reject(i)})}}])}]).controller("RootCtl",["$scope","$http","locales",function(f,g,e){f.page={};f.locales=e;f.social_accounts=[{url:"https://twitter.com/kstepme",icon:"http://twitter.com/favicon.ico",name:"Twitter"},{url:"http://www.linkedin.com/pub/konstantin-stepanov/54/47/450",icon:"http://www.linkedin.com/favicon.ico",name:"LinkedIn"},{url:"http://kstepme.moikrug.ru/",icon:"http://moikrug.ru/favicon.ico",name:"Мой Круг"},{url:"http://welinux.ru/user/kstep/",icon:"http://welinux.ru/favicon.ico",name:"WeLinux"},{url:"https://github.com/kstep",icon:"http://github.com/favicon.ico",name:"Github"},{url:"http://www.ohloh.net/accounts/kstep",icon:"http://www.ohloh.net/favicon.ico",name:"Ohloh"},{url:"http://search.cpan.org/~kstepme/",icon:"http://search.cpan.org/favicon.ico",name:"CPAN"}]}]).directive("ngMeta",["$parse",function(e){return{restrict:"E",terminal:true,compile:function(i,g){if(!g.value&&!g.update){return}var j=e(g.name),f=g.value?e(g.value):null,h=g.update?e(g.update):null;return function(l,m,k){if(f){j.assign(l,f(l))}if(h){b.extend(j(l),h(l))}}}}}]).controller("PostCtl",["$scope","$routeParams",function(f,e){b.extend(f.page,{url:"/"+e.year+"/"+e.month+"/"+e.day+"/"+e.name+".html",group:"blog"})}]).controller("BlogCtl",["$scope","$routeParams","$http","Pager",function(f,e,i,h){f.$watch("locale.index_title",function(j){f.page.title=j});b.extend(f.page,{title:f.locale.index_title,url:"/",group:"blog"});var g=((e.year||"")+"-"+(e.month||"")+"-"+(e.day||"")).replace(/-+$/g,"");f.date={year:e.year,month:e.month,day:e.day};f.pager=i.get("/data/list.json").then(function(j){var k=j.data;if(g){k=a.filter(k,function(l){return l.date.indexOf(g)!==-1})}return new h(k,40,1)})}]).controller("TagCtl",["$scope","$http","$routeParams",function(f,g,e){f.$watch("locale.tag",function(h){f.page.title=h+" — "+e.tag});b.extend(f.page,{url:"/tag/"+e.tag,group:"tags"});g.get("/data/tags.json").then(function(h){f.tag=h.data[e.tag];f.tag.name=e.tag})}]).controller("TagsCtl",["$scope","$http",function(e,f){e.$watch("locale.tag_cloud",function(g){e.page.title=g});b.extend(e.page,{url:"/tags",group:"tags"});f.get("/data/tags.json").then(function(g){var h=g.data,i=a.pluck(h,"size"),j=a.min(i),k=a.max(i)-j;a.each(h,function(l){l.size=(l.size-j)/k});e.tags=h})}])}(window.angular,window.jQuery,window._));