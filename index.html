<!DOCTYPE html>
<html lang="en" ng-app="kstep" ng-controller="RootCtl">
    <head>
        <meta charset="utf-8">
        <title ng-bind="page.title"></title>
        <meta name="description" content="{{ page.description }}">
        <meta name="author" content="Konstantin Stepanov" />

        <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.0/css/bootstrap-combined.min.css" rel="stylesheet" type="text/css" />
    </head>

    <body style="margin-top: 60px;">
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="brand" href="/#!/">//kstep</a>
                    <ul class="nav">
                        <li ng-class="{ active: page.group == 'blog' }"><a href="/#!/blog">Blog</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="content" ng-view>
            </div>

        </div> <!-- /container -->

        <footer class="form-actions" style="left: 0; right: 0; bottom: 0; position: fixed; margin-bottom: 0;">
            <div class="container">
                <p>&copy; Konstantin Stepanov 2012</p>
            </div>
        </footer>

        <!--[if lt IE 9]>
        <script src="http:http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/angularjs/1.0.2/angular.min.js"></script>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script type="text/javascript" src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.0/js/bootstrap.min.js"></script>

<script type="text/javascript">
!function (angular, document, $, undefined) {
    angular.module('kstep', ['ng'])
    .config(['$routeProvider', '$locationProvider', '$interpolateProvider',
    function ($route, $location, $interpolate) {
        $route
        .when('/', { controller: 'HomeCtl' })
        .when('/blog', { controller: 'BlogCtl', templateUrl: '/posts/list.html' })
        .when('/pages/:name.html', { controller: 'PageCtl', template: '<div ng-include="page.url"></div>' })
        .when('/:year/:month/:day/:name.html', { controller: 'PostCtl', template: '<div ng-include="page.url"></div>' })
        .otherwise({ redirectTo: '/' });

        $location.html5Mode(false).hashPrefix('!');

        $interpolate.startSymbol('{:').endSymbol(':}');
    }])
    .controller('RootCtl', ['$scope', '$http', function ($scope, $http) {
        $scope.page = {};
        $scope.pages = $http.get('/pages/list.json');
    }])
    .controller('HomeCtl', ['$scope', function ($scope) {
        $scope.page.title = 'Home sweep home';
        $scope.page.url = '/';
        $scope.page.group = 'home';
    }])
    .controller('PageCtl', ['$scope', '$routeParams', function ($scope, $params) {
        $scope.page.url = '/pages/' + $params.name + '.html';
        $scope.page.group = 'pages';
    }])
    .controller('PostCtl', ['$scope', '$routeParams', function ($scope, $params) {
        $scope.page.url = '/' + $params.year + '/' + $params.month + '/' + $params.day + '/' + $params.name + '.html';
        $scope.page.group = 'blog';
    }])
    .controller('BlogCtl', ['$scope', '$routeParams', '$http', function ($scope, $params, $http) {
        $scope.page.url = '/blog';
        $scope.page.group = 'blog';
        $scope.posts = $http.get('/posts/list.json');
    }])
    ;
}(window.angular, window.document, window.jQuery);
</script>

  </body>
</html>

