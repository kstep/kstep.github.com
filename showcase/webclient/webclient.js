function _crm(){function a(){return t+=1,b.set("eventsCount",t),t}function b(){function a(a,b,c){"undefined"==typeof b&&(c=-999999999,b=""),c=c||9999999999;var d=new Date;d.setTime(d.getTime()+1e3*c);var e="; expires="+d.toGMTString();r.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+e+"; path=/"}function b(a){var b=r.cookie.split("; ");a=encodeURIComponent(a);for(var c=0,d=b.length;d>c;c++){var e=b[c].split("=",2);if(e[0]==a)return decodeURIComponent(e[1])}}var c=this;c.set=function(b,c,d){a(b,c,d)},c.get=function(a){return b(a)}}function c(a){function b(a){return"/report"}function c(a){return a.toMessage?a.toMessage():JSON.stringify(a)}var d=this;d.baseUrl=a;var e;if(q.XMLHttpRequest&&"withCredentials"in new q.XMLHttpRequest)e=q.XMLHttpRequest;else{if(!q.XDomainRequest)throw new Error("CORS request API missing");e=q.XDomainRequest}d.send=function(a,f){f=f||"";var g=new e;g.open("POST",d.baseUrl+f+b(a),!0),g.setRequestHeader("Content-Type","application/json; charset=utf-8"),g.send(c(a))}}function d(){return JSON.stringify(this)}function e(a){return a?a.split("/")[2].replace("www.",""):null}function f(a){if(!a)return{};var b,c,d=/\+/g,e=/([^&=]+)=?([^&]*)/g,f=function(a){return decodeURIComponent(a.replace(d," "))},g=a.split("?")[1]||"";for(b={};c=e.exec(g);)b[f(c[1])]=f(c[2]);return b}function g(){var a=f(q.referrer),c=b.get("crm_campaign"),d={};if(c)try{d=JSON.parse(c)}catch(e){if(!(e instanceof SyntaxError))throw e;console.log("ignoring crm campaign data from storage")}var g={source:a.utm_source||d.source||void 0,name:a.utm_campaign||d.name||void 0,content:a.utm_content||d.content||void 0};return b.set("crm_campaign",JSON.stringify(g)),g}function h(b,c){function d(){return"undefined"==typeof q.orientation?"desktop":"mobile"}function g(){return-1!=s.appVersion.indexOf("Android")?"android":-1!=s.appVersion.indexOf("Win")?"windows":-1!=s.appVersion.indexOf("Mac")?"mac":-1!=s.appVersion.indexOf("Linux")||-1!=s.userAgent.indexOf("Linux")?"linux":-1!=s.appVersion.indexOf("X11")?"unix":void 0}function h(){var a=s.userAgent.toLowerCase();return-1!=a.indexOf("opera/")||-1!=a.indexOf("opr/")?"Opera":-1!=a.indexOf("seamonkey/")?"Seamonkey":-1!=a.indexOf("firefox/")?"Firefox":-1!=a.indexOf("chrome/")?"Chrome":-1!=a.indexOf(";msie ")?"MSIE":-1!=a.indexOf("android")?"Android":void 0}if(!b)throw new Error("argument 'report_type' is required");var i=f(q.location.search),j=f(q.referrer),k={report_type:b,site:c.site,site_version:c.site_version,js_version:m,client_timestamp:(new Date).getTime(),client_timezone:c.timezone,user_id:c.user_id,custom_login_id:c.custom_login_id||void 0,session_id:c.session_id,event_count:a(),browser:h(),device_type:d(),os:g(),user_agent:s.userAgent,site_type:c.site_type,page_url:q.location.href,page_path:q.location.pathname,page_qs:JSON.stringify(i),referrer_url:q.referrer||void 0,referrer_domain:e(q.referrer)||void 0,referrer_qs:JSON.stringify(j)||void 0,campaign_source:c.campaign.source||void 0,campaign_id:c.campaign.name||void 0,ad_id:c.campaign.content||void 0,event_category:void 0,event:void 0,optional_params:void 0,optional_params_type:void 0};return k}function i(a,c,d,e,f){function h(){var a=new Date,b=-a.getTimezoneOffset(),c=function(a){return 10>a?"0"+a:""+a},d=c(Math.abs(Math.floor(b/60))),e=c(Math.abs(b%60)),f=0>b?"-":"+";return f+d+":"+e}function i(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b}if(!a)throw new Error("argument 'site' is required");if(!c)throw new Error("argument 'siteVersion' is required");if(!f)throw new Error("argument 'sessionExpires_sec' is required");var j=this,k=!1;j.site=a,j.site_version=c,j.site_type=d,j.timezone=h(),j.user_id=b.get("crm_userId"),j.user_id||(j.user_id=i(),b.set("crm_userId",j.user_id)),j.custom_login_id=e||b.get("crm_customLoginId"),b.set("crm_customLoginId",j.custom_login_id),j.session_id=b.get("crm_sessionId"),j.session_id||(j.session_id=i(),b.set("crm_sessionId",j.session_id,f),k=!0),j.extendSession=function(){b.set("crm_sessionId",j.session_id,f)},j.setCustomLoginId=function(a){j.custom_login_id=a,b.set("crm_customLoginId",a)},j.isNewSession=function(){return k},j.campaign=g()}function j(a){if(!a)throw new Error("argument 'identity' is required");var b=this;b.identity=a,b.getPath=function(){return"/session"}}function k(a,b,c,d,e){if(!a)throw new Error("argument 'identity' is required");if(!b)throw new Error("argument 'eventType' is required");if(!c)throw new Error("argument 'category' is required");var f=this;d=d||{},f.identity=a,f.event={event_type:b,category:c,params:d,options:e},f.getPath=function(){return"/event"}}function l(a,b){if(!a)throw new Error("argument 'identity' is required");if(!b)throw new Error("argument 'profile' is required");var c=this;c.identity=a,c.profile=b,c.getPath=function(){return"/user_profile"}}var m="1.0",n=this,b=new b,o=void 0,p=void 0,q=window,r=q.document,s=q.navigator,t=parseInt(b.get("eventsCount"),10)||0;n.init=function(a){if(!a)throw new Error("options argument was not provided");if(!a.site)throw new Error("option 'site' is required");if(!a.siteVersion)throw new Error("option 'siteVersion' is required");if(!a.url)throw new Error("option 'url' is required");if(a.sessionExpires_sec=a.sessionExpires_sec||5400,a.siteType=a.siteType||"desktop",o=new c(a.url),p=new i(a.site,a.siteVersion,a.siteType,a.customLoginId,a.sessionExpires_sec),p.isNewSession()){t=0;var b=new j(p);o.send(b)}a.callback&&a.callback()},n.setCustomLoginId=function(a){if("undefined"==typeof a)throw new Error("argument 'id' is required");p.setCustomLoginId(a||void 0)},n.trackEvent=function(a,b,c,d){var e=new k(p,a,b,c,d);o.send(e),p.extendSession()},n.trackEvents=function(a){for(var b=0,c=a;c>b;b++){var d=a[b];n.trackEvent(d.type,d.category,d.params,d.options)}},n.runQueue=function(a){var b,c,d,e;for(d=0,e=a.length;e>d;d++)c=a[d],c instanceof Array&&(b=c.shift(),"_"!==b.charAt(0)&&n[b]instanceof Function&&n[b].apply(n,c))},n.userProfile=function(a){var b=new l(p,a);o.send(b),p.extendSession()},n._jsonpCallback=function(a){},i.prototype.toMessage=d,j.prototype.toMessage=function(){var a=h("session",this.identity);return a.event_category="session",JSON.stringify(a)},k.prototype.toMessage=function(){var a=this,b=h("event_tracking",a.identity);b.event_category=a.event.category,b.event=a.event.event_type;var c=a.event.params;for(var d in c)b["p_"+d]=c[d];return a.event.options&&(b.optional_params_type="event_optional_param",b.optional_params=JSON.stringify(a.event.options)),JSON.stringify(b)},l.prototype.toMessage=function(){var a=this,b=h("user_profile",a.identity);return b.event_category="user_profile",b.optional_params_type="user_info",b.optional_params=JSON.stringify(a.profile),JSON.stringify(b)}}!function(a){a._crm=new _crm,a._crm_options&&_crm.init(a._crm_options),a._crmq&&_crm.runQueue(a._crmq),a._crmq={push:function(){var a=Array.prototype.slice.call(arguments);return _crm.runQueue(a)},concat:function(){for(var a=Array.prototype.slice.call(arguments),b=0,c=a.length;c>b;b++)return _crm.runQueue(a[b])}}}(window);